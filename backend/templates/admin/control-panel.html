{% extends "admin/base-dashboard.html" %} {% load static %}

{% block style %}
<style>
.dropdown:hover .dropdown-menu {
    display: block;
    margin-top: 0;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu .dropdown-menu {
  top: 0;
  left: 100%;
}
.dropdown-menu .dropdown-item {
  font-size: 24px;
}
</style>
{% endblock style %}

{% block content %}
{% if bagan.tipe_tanding == '1' %}
<div class="container">
    <form method="POST">
    {% csrf_token %}
    <div class="page-inner">
        <div class="page-header">
            <a href="{% url 'admin-bagan-detail' event_pk=event.pk bagan_pk=bagan.pk %}" class="btn btn-danger">
                <b>Kembali</b>
            </a>
            <button type="submit" name="submit_type" value="kata-simpan" class="btn btn-success" style="margin-left: 5px;"><b>Simpan & Keluar</b></button>
          <h3 class="fw-bold mb-3"></h3>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                        <div class="card-title" style="margin-right: 10px;"><b style="color: red;">{{ detail_bagan.atlet1.nama_atlet }}</b> vs <b style="color: blue">{{ detail_bagan.atlet2.nama_atlet }}</b></div>
                        <div></div>
                    </div>
                    <div class="card-body">
                        <table class="table table-striped mt-3">
                            <thead>
                                <tr>
                                <th scope="col" style="text-align: center; width: 1000px;">Nama Atlet</th>
                                <th scope="col" id="j1" style="text-align: center; {% if aka_score.score1 != '0.0' and ao_score.score1 != '0.0' %}{% if aka_score.score1 > ao_score.score1 %}background-color: red{% else %}background-color: blue{% endif %}{% endif %}">J1</th>
                                <th scope="col" id="j2" style="text-align: center; {% if aka_score.score2 != '0.0' and ao_score.score2 != '0.0' %}{% if aka_score.score2 > ao_score.score2 %}background-color: red{% else %}background-color: blue{% endif %}{% endif %}">J2</th>
                                <th scope="col" id="j3" style="text-align: center; {% if aka_score.score3 != '0.0' and ao_score.score3 != '0.0' %}{% if aka_score.score3 > ao_score.score3 %}background-color: red{% else %}background-color: blue{% endif %}{% endif %}">J3</th>
                                <th scope="col" id="j4" style="text-align: center; {% if aka_score.score4 != '0.0' and ao_score.score4 != '0.0' %}{% if aka_score.score4 > ao_score.score4 %}background-color: red{% else %}background-color: blue{% endif %}{% endif %}">J4</th>
                                <th scope="col" id="j5" style="text-align: center; {% if aka_score.score5 != '0.0' and ao_score.score5 != '0.0' %}{% if aka_score.score5 > ao_score.score5 %}background-color: red{% else %}background-color: blue{% endif %}{% endif %}">J5</th>
                                <th scope="col" style="text-align: center;">Manual</th>
                                <th scope="col" style="text-align: center;">Total</th>
                                <th scope="col" style="text-align: center;">Pemenang</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <b><span style="color: red">{{ detail_bagan.atlet1.nama_atlet }}</span> - {{ detail_bagan.atlet1.perguruan.nama_perguruan }} - {{ detail_bagan.atlet1.utusan.nama_utusan }}</b>
                                    </td>
                                    <td style="text-align: center; font-size: 20px;">
                                        <input type="text" style="width: 250%; text-align: center; margin-left: -15px;" id="akaj1" name="akaScores" value="{{ aka_score.score1 }}">
                                    </td>
                                    <td style="text-align: center; font-size: 20px;">
                                        <input type="text" style="width: 250%; text-align: center; margin-left: -15px;" id="akaj2" name="akaScores" value="{{ aka_score.score2 }}">
                                    </td>
                                    <td style="text-align: center; font-size: 20px;">
                                        <input type="text" style="width: 250%; text-align: center; margin-left: -15px;" id="akaj3" name="akaScores" value="{{ aka_score.score3 }}">
                                    </td>
                                    <td style="text-align: center; font-size: 20px;">
                                        <input type="text" style="width: 250%; text-align: center; margin-left: -15px;" id="akaj4" name="akaScores" value="{{ aka_score.score4 }}">
                                    </td>
                                    <td style="text-align: center; font-size: 20px;">
                                        <input type="text" style="width: 250%; text-align: center; margin-left: -15px;" id="akaj5" name="akaScores" value="{{ aka_score.score5 }}">
                                    </td>
                                    <td style="text-align: center; font-size: 20px;">
                                        <select class="" id="aka-bendera">
                                            <option value="-">-</option>
                                            <option value="0">0</option>
                                            <option value="1">1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                            <option value="4">4</option>
                                            <option value="5">5</option>
                                        </select>
                                    </td>
                                    <td style="text-align: center; font-size: 20px;">
                                        <input type="text" style="width: 150%; text-align: center; margin-left: -13px;" id="totalAka" name="totalAka" value="{% if detail_bagan.score1 %}{{ detail_bagan.score1 }}{% else %}0.0{% endif %}">
                                    </td>
                                    <td style="text-align: center;">
                                        <input class="form-check-input" type="radio" name="pemenang" value="aka" style="transform: scale(2);">
                                    </td>
                                </tr>

                                <tr>
                                    <td>
                                        <b><span style="color: blue">{{ detail_bagan.atlet2.nama_atlet }}</span> - {{ detail_bagan.atlet2.perguruan.nama_perguruan }} - {{ detail_bagan.atlet2.utusan.nama_utusan }}</b>
                                    </td>
                                    <td style="text-align: center; font-size: 20px;">
                                        <input type="text" style="width: 250%; text-align: center; margin-left: -15px;" id="aoj1" name="aoScores" value="{{ ao_score.score1 }}">
                                    </td>
                                    <td style="text-align: center; font-size: 20px;">
                                        <input type="text" style="width: 250%; text-align: center; margin-left: -15px;" id="aoj2" name="aoScores" value="{{ ao_score.score2 }}">
                                    </td>
                                    <td style="text-align: center; font-size: 20px;">
                                        <input type="text" style="width: 250%; text-align: center; margin-left: -15px;" id="aoj3" name="aoScores" value="{{ ao_score.score3 }}">
                                    </td>
                                    <td style="text-align: center; font-size: 20px;">
                                        <input type="text" style="width: 250%; text-align: center; margin-left: -15px;" id="aoj4" name="aoScores" value="{{ ao_score.score4 }}">
                                    </td>
                                    <td style="text-align: center; font-size: 20px;">
                                        <input type="text" style="width: 250%; text-align: center; margin-left: -15px;" id="aoj5" name="aoScores" value="{{ ao_score.score5 }}">
                                    </td>
                                    <td style="text-align: center; font-size: 20px;">
                                        <input type="text" style="width: 50%; text-align: center; margin-left: 0px;" id="ao-bendera" value="0" readonly>
                                    </td>
                                    <td style="text-align: center; font-size: 20px;">
                                        <input type="text" style="width: 150%; text-align: center; margin-left: -13px;" id="totalAo" name="totalAo" value="{% if detail_bagan.score2 %}{{ detail_bagan.score2 }}{% else %}0.0{% endif %}">
                                    </td>
                                    <td style="text-align: center;">
                                        <input class="form-check-input" type="radio" name="pemenang" value="ao" style="transform: scale(2);">
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                        <div class="card-title d-flex align-items-center flex-wrap gap-3">
                            <!-- Tampilkan Score Button -->
                            <button type="button" class="btn btn-secondary btn-sm" id="tampilkan-score" style="font-size: inherit;
                                {% if bagan.tipe_tanding == '2' %}visibility: hidden{% endif %}">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button type="button" class="btn btn-black btn-sm" id="tampilkan-score-simple" style="font-size: inherit;
                                {% if bagan.tipe_tanding == '2' %}visibility: hidden{% endif %}">
                                <i class="fas fa-eye"></i>
                            </button>

                            <span class="text-muted">|</span>
                            <span class="fw-semibold">Countdown</span>

                            <!-- Dropdown -->
                            <div class="dropdown">
                                <button class="btn btn-success btn-sm dropdown-toggle"
                                        type="button"
                                        id="aka-score-inc"
                                        data-bs-toggle="dropdown"
                                        aria-expanded="false">
                                    +
                                </button>

                                <ul class="dropdown-menu p-3" aria-labelledby="aka-score-inc" style="min-width: 200px;">
                                    <li class="form-check mb-3" style="font-size: 1.2rem; font-weight: 800;">
                                        <input class="form-check-input"
                                            type="checkbox"
                                            id="countdown"
                                            name="countdown"
                                            style="transform: scale(2); margin-right: 10px;">
                                        <label class="form-check-label ms-2" for="countdown">Aka</label>
                                    </li>
                                    <li class="form-check" style="font-size: 1.2rem; font-weight: 800;">
                                        <input class="form-check-input"
                                            type="checkbox"
                                            id="countdown1"
                                            name="countdown1"
                                            style="transform: scale(2); margin-right: 10px;">
                                        <label class="form-check-label ms-2" for="countdown1">Ao</label>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <div class="d-flex align-items-center gap-2">
                            <select class="form-control" id="timer-choice">
                                <option value="0" selected>00:00</option>
                                <option value="30">00:30</option>
                                <option value="60">01:00</option>
                                <option value="90">01:30</option>
                                <option value="120">02:00</option>
                                <option value="150">02:30</option>
                                <option value="180">03:00</option>
                                <option value="210">03:30</option>
                                <option value="240">04:00</option>
                                <option value="270">04:30</option>
                                <option value="300">05:00</option>
                            </select>
                            <button type="button" class="btn btn-primary" id="start-timer" style="font-size: 25px;">Start</button>
                        </div>
                    </div>
                    <div class="card-body" style="text-align: center;">
                        <p style="font-weight: bold; font-size: 50px;">
                            <button type="button" id="timer-decrement" class="btn btn-primary" style="padding: 5px 10px; font-size: 20px;">-</button>
                            <span id="minutes">00</span>:
                            <span id="seconds">00</span>:
                            <span id="milliseconds">00</span>
                            <button type="button" id="timer-increment" class="btn btn-primary" style="padding: 5px 10px; font-size: 20px;">+</button>
                        </p>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card">
                    <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                        <div class="card-title" style="margin-right: 10px;">
                            Kata Input
                        </div>
                    </div>
                    <div class="card-body" style="text-align: center;">
                        <table class="table table-striped mt-3">
                            <thead>
                                <tr>
                                <th scope="col" style="text-align: center;;">Info</th>
                                <th scope="col" style="text-align: center;">Kata</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <b><span style="font-size: 20px; color: red">Aka</span></b>
                                    </td>
                                    <td style="text-align: center; font-size: 20px;">
                                        <select class="form-select select2" name="kata-aka" id="kata-aka">
                                        </select>
                                    </td>
                                </tr>

                                <tr>
                                    <td>
                                        <b><span style="font-size: 20px; color: blue">Ao</span></b>
                                    </td>
                                    <td style="text-align: center; font-size: 20px;">
                                        <select class="form-select select2" name="kata-ao" id="kata-ao">
                                        </select>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </form>
</div>
{% else %}
<div class="container">
    <form method="POST">
    {% csrf_token %}
    <div class="page-inner">
        <div class="page-header">
            <a href="{% url 'admin-bagan-detail' event_pk=event.pk bagan_pk=bagan.pk %}" class="btn btn-danger">
                <b>Kembali</b>
            </a>
            <button type="submit" name="submit_type" value="kumite-simpan" class="btn btn-success" style="margin-left: 5px;"><b>Simpan & Keluar</b></button>
          <h3 class="fw-bold mb-3"></h3>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                        <div class="card-title" style="margin-right: 10px;"><b style="color: red;">{{ detail_bagan.atlet1.nama_atlet }}</b> vs <b style="color: blue">{{ detail_bagan.atlet2.nama_atlet }}</b></div>
                        <div></div>
                    </div>
                    <div class="card-body">
                        <table class="table table-striped mt-3">
                            <thead>
                                <tr>
                                <th scope="col" style="text-align: center;">Nama Atlet</th>
                                <th scope="col" style="text-align: center;">Score</th>
                                <th scope="col" style="text-align: center;">Senshu</th>
                                <th scope="col" style="text-align: center;">Criteria</th>
                                <th scope="col" style="text-align: center;">VR</th>
                                <th scope="col" style="text-align: center;">Pemenang</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <b><span style="color: red">{{ detail_bagan.atlet1.nama_atlet }}</span> - {{ detail_bagan.atlet1.perguruan.nama_perguruan }} - {{ detail_bagan.atlet1.utusan.nama_utusan }}</b>
                                    </td>
                                    <td style="text-align: center; font-size: 20px;">
                                        <button type="button" class="btn btn-warning" id="aka-score-dec">-</button>
                                        <input type="number" style="text-align: center; width: 20%" id="aka-score" name="akaScore" value="0">
                                        <div class="dropdown" style="display: inline-block; position: relative;">
                                            <button type="button" class="btn btn-success dropdown-toggle" id="aka-score-inc">
                                                +
                                            </button>
                                            <ul class="dropdown-menu" aria-labelledby="aka-score-inc">
                                                <li><button type="button" style="font-size: 30px;" id="aka-yuko" class="dropdown-item" href="#">Yuko +1</button></li>
                                                <li><button type="button" style="font-size: 30px;" id="aka-wazaari" class="dropdown-item" href="#">Waza-ari +2</button></li>
                                                <li><button type="button" style="font-size: 30px;" id="aka-ippon" class="dropdown-item" href="#">Ippon +3</button></li>
                                            </ul>
                                        </div>
                                    </td>
                                    <td style="text-align: center;">
                                        <input class="form-check-input" type="checkbox" name="aka-senshu" id="aka-senshu" style="transform: scale(2);">
                                    </td>
                                    <td style="text-align: center; font-size: 20px;">
                                        <button type="button" class="btn btn-warning" id="aka-criteria-dec">-</button>
                                        <input type="number" style="text-align: center; width: 20%" id="aka-criteria" name="akaCriteria" value="0">
                                        <button type="button" class="btn btn-success" id="aka-criteria-inc">+</button>
                                    </td>
                                    <td style="text-align: center;">
                                        <input class="form-check-input" type="checkbox" name="aka-vr" id="aka-vr" style="transform: scale(2);" {% if detail_bagan.vr1 %}checked{% endif %}>
                                    </td>
                                    <td style="text-align: center;">
                                        <input class="form-check-input" type="radio" name="pemenang" value="aka" style="transform: scale(2);">
                                    </td>
                                </tr>

                                <tr>
                                    <td>
                                        <b><span style="color: blue">{{ detail_bagan.atlet2.nama_atlet }}</span> - {{ detail_bagan.atlet2.perguruan.nama_perguruan }} - {{ detail_bagan.atlet2.utusan.nama_utusan }}</b>
                                    </td>
                                    <td style="text-align: center; font-size: 20px;">
                                        <button type="button" class="btn btn-warning" id="ao-score-dec">-</button>
                                        <input type="number" style="text-align: center; width: 20%" id="ao-score" name="aoScore" value="0">
                                        <div class="dropdown" style="display: inline-block; position: relative;">
                                            <button type="button" class="btn btn-success dropdown-toggle" id="ao-score-inc">
                                                +
                                            </button>
                                            <ul class="dropdown-menu" aria-labelledby="ao-score-inc">
                                                <li><button type="button" style="font-size: 30px;" id="ao-yuko" class="dropdown-item" href="#">Yuko +1</button></li>
                                                <li><button type="button" style="font-size: 30px;" id="ao-wazaari" class="dropdown-item" href="#">Waza-ari +2</button></li>
                                                <li><button type="button" style="font-size: 30px;" id="ao-ippon" class="dropdown-item" href="#">Ippon +3</button></li>
                                            </ul>
                                        </div>
                                    </td>
                                    <td style="text-align: center;">
                                        <input class="form-check-input" type="checkbox" name="ao-senshu" id="ao-senshu" style="transform: scale(2);">
                                    </td>
                                    <td style="text-align: center; font-size: 20px;">
                                        <button type="button" class="btn btn-warning" id="ao-criteria-dec">-</button>
                                        <input type="number" style="text-align: center; width: 20%" id="ao-criteria" name="aoCriteria" value="0">
                                        <button type="button" class="btn btn-success" id="ao-criteria-inc">+</button>
                                    </td>
                                    <td style="text-align: center;">
                                        <input class="form-check-input" type="checkbox" name="ao-vr" id="ao-vr" style="transform: scale(2);" {% if detail_bagan.vr2 %}checked{% endif %}>
                                    </td>
                                    <td style="text-align: center;">
                                        <input class="form-check-input" type="radio" name="pemenang" value="ao" style="transform: scale(2);">
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                        <div class="card-title" style="margin-right: 10px;">
                            Control Panel
                            {% if bagan.tipe_tanding == '1' %}
                            <button type="button" class="btn btn-secondary" id="tampilkan-score" style="font-size: inherit; padding: 5px 10px; {% if bagan.tipe_tanding == '2' %}visibility: hidden{% endif %}">Tampilkan Score</button>
                            {% else %}
                            | Check Mouse
                            <input class="form-check-input" type="checkbox" name="ms-check" id="ms-check" style="transform: scale(2); margin-left: 10px;">
                            | HANTEI?
                            <input class="form-check-input" type="checkbox" name="hantei" id="hantei" style="transform: scale(2); margin-left: 10px;">
                            {% endif %}
                        </div>
                        <div class="d-flex align-items-center gap-2">
                            <select class="form-control" id="timer-choice">
                                <option value="0" selected>00:00</option>
                                <option value="30">00:30</option>
                                <option value="60">01:00</option>
                                <option value="90">01:30</option>
                                <option value="120">02:00</option>
                                <option value="150">02:30</option>
                                <option value="180">03:00</option>
                                <option value="210">03:30</option>
                                <option value="240">04:00</option>
                                <option value="270">04:30</option>
                                <option value="300">05:00</option>
                            </select>
                            <button type="button" class="btn btn-primary" id="start-timer" style="font-size: 25px;">Start</button>
                        </div>
                    </div>
                    <div class="card-body" style="text-align: center;">
                        <p style="font-weight: bold; font-size: 50px;">
                            <button type="button" id="timer-decrement" class="btn btn-primary" style="padding: 5px 10px; font-size: 20px;">-</button>
                            <span id="minutes">00</span>:
                            <span id="seconds">00</span>:
                            <span id="milliseconds">00</span>
                            <button type="button" id="timer-increment" class="btn btn-primary" style="padding: 5px 10px; font-size: 20px;">+</button>
                        </p>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                        <div class="card-title" style="margin-right: 10px;">
                            Histori Score Mouse Stick 
                        </div>
                        <div class="d-flex align-items-center gap-2">
                            <button type="button" class="btn btn-warning" id="ms-reset" style="font-size: 25px;">Tutup Banner Score X</button>
                        </div>
                    </div>
                    <div class="card-body" style="text-align: center;">
                        <table class="table table-striped mt-3" id="ms-table">
                            <thead>
                                <tr>
                                    <th scope="col" style="text-align: center;">Timer</th>
                                    <th scope="col" style="text-align: center;">J1</th>
                                    <th scope="col" style="text-align: center;">J2</th>
                                    <th scope="col" style="text-align: center;">J3</th>
                                    <th scope="col" style="text-align: center;">J4</th>
                                    <th scope="col" style="text-align: center;">Score Aka</th>
                                    <th scope="col" style="text-align: center;">Score Ao</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>00:00</td>
                                    <td style="text-align: center; font-size: 20px;">
                                        <span id="j1-aka">-</span>
                                        /
                                        <span id="j1-ao">-</span>
                                    </td>
                                    <td style="text-align: center; font-size: 20px;">
                                        <span id="j2-aka">-</span>
                                        /
                                        <span id="j2-ao">-</span>
                                    </td>
                                    <td style="text-align: center; font-size: 20px;">
                                        <span id="j3-aka">-</span>
                                        /
                                        <span id="j3-ao">-</span>
                                    </td>
                                    <td style="text-align: center; font-size: 20px;">
                                        <span id="j4-aka">-</span>
                                        /
                                        <span id="j4-ao">-</span>
                                    </td>
                                    <td style="text-align: center; font-size: 20px;">
                                        <span id="ms-aka">-</span>
                                    </td>
                                    <td style="text-align: center; font-size: 20px;">
                                        <span id="ms-ao">-</span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card">
                    <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                        <div class="card-title" style="margin-right: 10px;">
                            VR Request
                        </div>
                    </div>
                    <div class="card-body" style="text-align: center;">
                        <table class="table table-striped mt-3">
                            <thead>
                                <tr>
                                <th scope="col" style="text-align: center;;">Info</th>
                                <th scope="col" style="text-align: center;">VR Info</th>
                                <th scope="col" style="text-align: center;">Request</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <b><span style="font-size: 20px; color: red">Aka</span></b>
                                    </td>
                                    <td style="text-align: center; font-size: 20px;">
                                        {% if detail_bagan.vr1 %}
                                        <div class="dropdown" style="display: inline-block;">
                                            <button type="button" class="btn btn-success dropdown-toggle" id="aka-vr-button">
                                                +
                                            </button>
                                            <ul class="dropdown-menu" aria-labelledby="aka-vr-button">
                                                <li><button type="button" style="font-size: 20px;" id="aka-request" class="dropdown-item">Request</button></li>
                                                <li class="dropdown-submenu">
                                                    <button type="button" id="aka-accept" class="dropdown-item dropdown-toggle">Accept</button>
                                                    <ul class="dropdown-menu">
                                                        <li><button type="button" class="dropdown-item" id="aka-accept-1">Accept +1</button></li>
                                                        <li><button type="button" class="dropdown-item" id="aka-accept-2">Accept +2</button></li>
                                                        <li><button type="button" class="dropdown-item" id="aka-accept-3">Accept +3</button></li>
                                                    </ul>
                                                </li>
                                                <li><button type="button" style="font-size: 20px;" id="aka-decline" class="dropdown-item">Decline</button></li>
                                            </ul>
                                        </div>
                                        {% else %}
                                        <button class="btn btn-light" disabled>Unavailable</button>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <b><span style="font-size: 20px;" id="aka-requested">-</span></b>
                                    </td>
                                </tr>

                                <tr>
                                    <td>
                                        <b><span style="font-size: 20px; color: blue">Ao</span></b>
                                    </td>
                                    <td style="text-align: center; font-size: 20px;">
                                        {% if detail_bagan.vr2 %}
                                        <div class="dropdown" style="display: inline-block;">
                                            <button type="button" class="btn btn-success dropdown-toggle" id="ao-vr-button">
                                                +
                                            </button>
                                            <ul class="dropdown-menu" aria-labelledby="ao-vr-button">
                                                <li><button type="button" style="font-size: 20px;" id="ao-request" class="dropdown-item">Request</button></li>
                                                <li class="dropdown-submenu">
                                                    <button type="button" id="ao-accept" class="dropdown-item dropdown-toggle">Accept</button>
                                                    <ul class="dropdown-menu">
                                                        <li><button type="button" class="dropdown-item" id="ao-accept-1">Accept +1</button></li>
                                                        <li><button type="button" class="dropdown-item" id="ao-accept-2">Accept +2</button></li>
                                                        <li><button type="button" class="dropdown-item" id="ao-accept-3">Accept +3</button></li>
                                                    </ul>
                                                </li>
                                                <li><button type="button" style="font-size: 20px;" id="ao-decline" class="dropdown-item">Decline</button></li>
                                            </ul>
                                        </div>
                                        {% else %}
                                        <button class="btn btn-light" disabled>Unavailable</button>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <b><span style="font-size: 20px;" id="ao-requested">-</span></b>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </form>
</div>
{% endif %}
<input type="hidden" id="tipe-tanding" value="{{ bagan.tipe_tanding }}">
{% endblock content %}

{% block script %}
<script>
    const tatamiPk = "{{ admin_tatami.tatami.pk }}";
    let milliseconds = 0;
    let totalSeconds = 0;
</script>
<script src="{% static 'mouse.js' %}"></script>
<script>
    $('.select2').select2({
        width: '100%'
    });
    $(document).on('click', '.dropdown-submenu > .dropdown-toggle', function(e){
        $(this).next('.dropdown-menu').toggle();
        e.stopPropagation();
        e.preventDefault();
    });

    let interval = null;
    let isRunning = false;
    let tampilkan = false;

    const tipeTanding = $('#tipe-tanding').val()

    let aka_score = 0 
    let ao_score = 0 

    let aka_criteria = 0
    let ao_criteria = 0

    const kataAka = document.getElementById('kata-aka');
    const kataAo = document.getElementById('kata-ao');

    function updateDisplay(seconds, ms) {
        if (seconds >= 0) {
            const minutes = Math.floor(seconds / 60);
            const secs = ((seconds % 60) + 60) % 60;
            $('#minutes').text(String(minutes).padStart(2, '0'));
            $('#seconds').text(String(secs).padStart(2, '0'));
            $('#milliseconds').text(String(ms).padStart(2, '0'));
        } 
    }

    const eventPk = {{ event.pk }}
    const baganPk = {{ bagan.pk }}
    const detailbaganPk = {{ detail_bagan.pk }}
    const protocol = window.location.protocol === 'https:' ? 'wss://' : 'ws://';
    const socket = new WebSocket(protocol + window.location.host + `/ws/admin-dashboard/${eventPk}/bagan-detail/${baganPk}/control-panel/${detailbaganPk}/tatami/${tatamiPk}`);

    socket.onmessage = function(e) {
        const data = JSON.parse(e.data);
        console.log(data.command, data.details)

        if (data.command >= '1' && data.command <= '5') {
            const detailsArray = JSON.parse(data.details);
            const atlet = detailsArray[0];
            const score = detailsArray[1];

            if (atlet === 'aka' || atlet === 'ao') {

                const prefix = atlet === 'aka' ? '#akaj' : '#aoj';
                const inputId = prefix + data.command;
                $(inputId).val(score);

                let scores = [];
                for (let i = 1; i <= 5; i++) {
                    const val = parseFloat($(prefix + i).val());
                    if (!isNaN(val) && val !== 0) {
                        scores.push(val);
                    }
                } 

                var aka_val = parseFloat($('#akaj' + data.command).val())
                var ao_val = parseFloat($('#aoj' + data.command).val())
                
                if (aka_val !== 0 && ao_val !== 0) {
                    if (aka_val > ao_val) {
                        $('#j' + data.command).css("background-color", "red")
                    } else if (aka_val < ao_val) {
                        $('#j' + data.command).css("background-color", "blue")
                    }
                }

                if (scores.length >= 5) {
                    aka_score = 0
                    ao_score = 0
                    for (let i = 1; i <= 5; i++) {
                        var juri = $('#j' + i).css('background-color')
                        if (juri == "rgb(255, 0, 0)" || juri == "red" ) {
                            aka_score += 1
                            $('#totalAka').val(aka_score)
                        } else if (juri == "rgb(0, 0, 255)" || juri == "blue" ) {
                            ao_score += 1
                            $('#totalAo').val(ao_score)
                        }
                    }
                }

                // if (scores.length >= 3) {
                //     scores.sort((a, b) => a - b);
                //     const trimmedScores = scores.slice(1, -1);
                //     const total = trimmedScores.reduce((a, b) => a + b, 0);
                //     console.log(total)
                //     if (atlet === 'aka') {
                //         $('#totalAka').val(total.toFixed(1));
                //     } else {
                //         $('#totalAo').val(total.toFixed(1));
                //     }
                // }
            }
        } else if (data.command == 'coach-supervisor') {
            const detailsArray = JSON.parse(data.details);
            const atlet = detailsArray[0];
            const score = detailsArray[1];

            if (atlet == 'aka') {
                $('#aka-requested').text(score)
            } else if (atlet == 'ao') {
                $('#ao-requested').text(score)
            }
        }
    }

    $('input[name="pemenang"]').on('change', function() {
        const selectedValue = $(this).val();
        let scoreAka = $('#totalAka').val();
        let scoreAo = $('#totalAo').val();
        $.ajax({
            url: '/jury-panel/{{ admin_tatami.tatami.pk }}/message-retriever',
            type: 'POST',
            data: {
                action: 'pemenang',
                details: selectedValue,
                // details: JSON.stringify([selectedValue, scoreAka, scoreAo]),
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
            },
        });
    });

    $('#aka-bendera').on('change', function() {
        $('#totalAka').val($(this).val())
        if ($(this).val() == '0') {
            $('#ao-bendera').val('5')
            $('#totalAo').val('5')
        } else if ($(this).val() == '1') {
            $('#ao-bendera').val('4')
            $('#totalAo').val('4')
        } else if ($(this).val() == '2') {
            $('#ao-bendera').val('3')
            $('#totalAo').val('3')
        } else if ($(this).val() == '3') {
            $('#ao-bendera').val('2')
            $('#totalAo').val('2')
        } else if ($(this).val() == '4') {
            $('#ao-bendera').val('1')
            $('#totalAo').val('1')
        } else if ($(this).val() == '5') {
            $('#ao-bendera').val('0')
            $('#totalAo').val('0')
        } else if ($(this).val() == '-') {
            $('#ao-bendera').val('0')
            $('#totalAo').val('0.0')
            $('#totalAka').val('0.0')
        }
        var aka_bendera = $(this).val()
        var ao_bendera = $('#ao-bendera').val()
        $.ajax({
            url: '/scoring-board/{{ admin_tatami.tatami.pk }}/message-retriever',
            type: 'POST',
            data: {
                action: 'bendera',
                details: JSON.stringify([aka_bendera, ao_bendera]),
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
            },
        });
    })

    $('#ms-check').on('click', function() {
        let ms_check = 0
        if ($(this).is(':checked')) {
            ms_check = 1
        } else {
            ms_check = 0
        }
        $.ajax({
            url: '/scoring-board/{{ admin_tatami.tatami.pk }}/message-retriever',
            type: 'POST',
            data: {
                action: 'ms-check',
                details: ms_check,
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
            },
        });
    })

    $('#countdown').on('click', function() {
        let countdown_val = 0
        if ($(this).is(':checked')) {
            countdown_val = 1
        } else {
            countdown_val = 0
        }
        $.ajax({
            url: '/scoring-board/{{ admin_tatami.tatami.pk }}/message-retriever',
            type: 'POST',
            data: {
                action: 'countdown-aka',
                details: countdown_val,
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
            },
        });
    })

    $('#countdown1').on('click', function() {
        let countdown_val = 0
        if ($(this).is(':checked')) {
            countdown_val = 1
        } else {
            countdown_val = 0
        }
        $.ajax({
            url: '/scoring-board/{{ admin_tatami.tatami.pk }}/message-retriever',
            type: 'POST',
            data: {
                action: 'countdown-ao',
                details: countdown_val,
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
            },
        });
    })

    $('#hantei').on('click', function() {
        let hantei = 0
        if ($(this).is(':checked')) {
            hantei = 1
        } else {
            hantei = 0
        }
        console.log(hantei)
        $.ajax({
            url: '/scoring-board/{{ admin_tatami.tatami.pk }}/message-retriever',
            type: 'POST',
            data: {
                action: 'hantei',
                details: hantei,
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
            },
        });
    })

    $('#ms-reset').on('click', function() {
        $.ajax({
            url: '/scoring-board/{{ admin_tatami.tatami.pk }}/message-retriever',
            type: 'POST',
            data: {
                action: 'reset-banner',
                details: '',
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
            },
        });
    })
    $('#aka-request').on('click', function() {
        kirim_vr('aka-request')
        $('#aka-requested').text('-')
        kirim_status_vr('aka', '1')
    })
    $('#aka-accept-1').on('click', function() {
        kirim_vr('aka-accept-1')
        $('#aka-requested').text('-')
        kirim_status_vr('aka', '1')
    })
    $('#aka-accept-2').on('click', function() {
        kirim_vr('aka-accept-2')
        $('#aka-requested').text('-')
        kirim_status_vr('aka', '1')
    })
    $('#aka-accept-3').on('click', function() {
        kirim_vr('aka-accept-3')
        $('#aka-requested').text('-')
        kirim_status_vr('aka', '1')
    })
    $('#aka-decline').on('click', function() {
        kirim_vr('aka-decline')
        $('#aka-vr').prop('checked', false)
        kirim_vr('aka-remove-vr')
        $('#aka-requested').text('-')
        kirim_status_vr('aka', '0')
    })
    $('#ao-request').on('click', function() {
        kirim_vr('ao-request')
        $('#ao-requested').text('-')
        kirim_status_vr('ao', '1')
    })
    $('#ao-accept-1').on('click', function() {
        kirim_vr('ao-accept-1')
        $('#ao-requested').text('-')
        kirim_status_vr('ao', '1')
    })
    $('#ao-accept-2').on('click', function() {
        kirim_vr('ao-accept-2')
        $('#ao-requested').text('-')
        kirim_status_vr('ao', '1')
    })
    $('#ao-accept-3').on('click', function() {
        kirim_vr('ao-accept-3')
        $('#ao-requested').text('-')
        kirim_status_vr('ao', '1')
    })
    $('#ao-decline').on('click', function() {
        kirim_vr('ao-decline')
        $('#ao-vr').prop('checked', false)
        kirim_vr('ao-remove-vr')
        $('#ao-requested').text('-')
        kirim_status_vr('ao', '0')
    })
    $('#aka-vr').on('change', function() {
        if ($(this).is(':checked')) {
            kirim_vr('aka-vr')
        } else {
            kirim_vr('aka-remove-vr')
        }
    })
    $('#ao-vr').on('change', function() {
        if ($(this).is(':checked')) {
            kirim_vr('ao-vr')
        } else {
            kirim_vr('ao-remove-vr')
        }
    })

    function kirim_status_vr(value1, value2) {
        $.ajax({
            url: '/coach-supervisor/{{ admin_tatami.tatami.pk }}/message-retriever',
            type: 'POST',
            data: {
                action: 'vr_status',
                details: JSON.stringify([value1, value2]),
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
            },
        });
    }

    function kirim_vr(vr_value) {
        $.ajax({
            url: '/scoring-board/{{ admin_tatami.tatami.pk }}/message-retriever',
            type: 'POST',
            data: {
                action: 'vr',
                details: vr_value,
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
            },
        });
    }

    $('#aka-senshu').on('change', function() {
        if ($(this).is(':checked')) {
            kirim_senshu('aka-senshu')
        } else {
            kirim_senshu('aka-remove-senshu')
        }
    })

    $('#ao-senshu').on('change', function() {
        if ($(this).is(':checked')) {
            kirim_senshu('ao-senshu')
        } else {
            kirim_senshu('ao-remove-senshu')
        }
    })

    function kirim_senshu(senshu_value) {
        $.ajax({
            url: '/scoring-board/{{ admin_tatami.tatami.pk }}/message-retriever',
            type: 'POST',
            data: {
                action: 'senshu',
                details: senshu_value,
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
            },
        });
    }

    $('#aka-score-dec').on('click', function() {
        if (aka_score != 0) {
            aka_score--;
            score('aka-score-dec')
        }
        $('#aka-score').val(aka_score)
    })
    $('#aka-yuko').on('click', function() {
        aka_score += 1;
        score('aka-yuko')
        $('#aka-score').val(aka_score)
    })
    $('#aka-wazaari').on('click', function() {
        aka_score += 2;
        score('aka-wazaari')
        $('#aka-score').val(aka_score)
    })
    $('#aka-ippon').on('click', function() {
        aka_score += 3;
        score('aka-ippon')
        $('#aka-score').val(aka_score)
    })
    $('#aka-criteria-dec').on('click', function() {
        if (aka_criteria != 0) {
            aka_criteria--;
            score('aka-criteria-dec')
        }
        $('#aka-criteria').val(aka_criteria)
    })
    $('#aka-criteria-inc').on('click', function() {
        aka_criteria++;
        score('aka-criteria-inc')
        $('#aka-criteria').val(aka_criteria)
    })
    $('#ao-score-dec').on('click', function() {
        if (ao_score != 0) {
            ao_score--;
            score('ao-score-dec')
        }
        $('#ao-score').val(ao_score)
    })
    $('#ao-yuko').on('click', function() {
        ao_score += 1;
        score('ao-yuko')
        $('#ao-score').val(ao_score)
    })
    $('#ao-wazaari').on('click', function() {
        ao_score += 2;
        score('ao-wazaari')
        $('#ao-score').val(ao_score)
    })
    $('#ao-ippon').on('click', function() {
        ao_score += 3;
        score('ao-ippon')
        $('#ao-score').val(ao_score)
    })
    $('#ao-criteria-dec').on('click', function() {
        if (ao_criteria != 0) {
            ao_criteria--;
            score('ao-criteria-dec')
        }
        $('#ao-criteria').val(ao_criteria)
    })
    $('#ao-criteria-inc').on('click', function() {
        ao_criteria++;
        score('ao-criteria-inc')
        $('#ao-criteria').val(ao_criteria)
    })

    function score(value) {
        $.ajax({
            url: '/scoring-board/{{ admin_tatami.tatami.pk }}/message-retriever',
            type: 'POST',
            data: {
                action: value,
                details: '',
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
            },
        });
    } 

    $('#kata-aka').on('change', function() {
        kata_val = $('#kata-aka').val()
        $.ajax({
            url: '/jury-panel/{{ admin_tatami.tatami.pk }}/message-retriever',
            type: 'POST',
            data: {
                action: 'aka-kata-kirim',
                details: kata_val,
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
            },
         });
         $.ajax({
            url: '/scoring-board/{{ admin_tatami.tatami.pk }}/message-retriever',
            type: 'POST',
            data: {
                action: 'aka-kata-kirim',
                details: kata_val,
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
            },
         });
    })

    $('#kata-ao').on('change', function() {
        kata_val = $('#kata-ao').val()
        $.ajax({
            url: '/jury-panel/{{ admin_tatami.tatami.pk }}/message-retriever',
            type: 'POST',
            data: {
                action: 'ao-kata-kirim',
                details: kata_val,
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
            },
         });
         $.ajax({
            url: '/scoring-board/{{ admin_tatami.tatami.pk }}/message-retriever',
            type: 'POST',
            data: {
                action: 'ao-kata-kirim',
                details: kata_val,
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
            },
         });
    })

    $('#tampilkan-score').on('click', function() {
        if (tampilkan == false) {
            $('#tampilkan-score').html('<i class="fas fa-eye-slash"></i>')
            tampilkan = true
        } else {
            $('#tampilkan-score').html('<i class="fas fa-eye"></i>')
            tampilkan = false
        }
        let scoreAka = $('#totalAka').val();
        let scoreAo = $('#totalAo').val();

        let scoresAka = []
        let scoresAo = []

        for (let i=1; i <= 5; i++) {
            scoresAka.push($(`#akaj${i}`).val())
            scoresAo.push($(`#aoj${i}`).val())
        }

        $.ajax({
            url: '/scoring-board/{{ admin_tatami.tatami.pk }}/message-retriever',
            type: 'POST',
            data: {
                action: 'tampilkan-score',
                details: JSON.stringify([scoreAka, scoreAo, scoresAka, scoresAo]),
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
            },
        });
    })

    $('#tampilkan-score-simple').on('click', function() {
        if (tampilkan == false) {
            $('#tampilkan-score-simple').html('<i class="fas fa-eye-slash"></i>')
            tampilkan = true
        } else {
            tampilkan = false
            $('#tampilkan-score-simple').html('<i class="fas fa-eye"></i>')
        }
        let scoreAka = $('#totalAka').val();
        let scoreAo = $('#totalAo').val();

        $.ajax({
            url: '/scoring-board/{{ admin_tatami.tatami.pk }}/message-retriever',
            type: 'POST',
            data: {
                action: 'tampilkan-score-simple',
                details: JSON.stringify([scoreAka, scoreAo]),
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
            },
        });
    })

    $('#timer-increment').on('click', function() {
        totalSeconds++;
        updateDisplay(totalSeconds, milliseconds);
        timer_func('timer-increment', '')
    })
    $('#timer-decrement').on('click', function() {
        totalSeconds--;
        updateDisplay(totalSeconds, milliseconds);
        timer_func('timer-decrement', '')
    })
    $('#timer-choice').on('change', function () {
        if (!isRunning) {
            totalSeconds = parseInt($(this).val());
            milliseconds = 0;
            updateDisplay(totalSeconds, milliseconds);
            timer_func('timer-change', totalSeconds)
        }
    });

    function timer_func(value1, value2) {
        $.ajax({
            url: '/scoring-board/{{ admin_tatami.tatami.pk }}/message-retriever',
            type: 'POST',
            data: {
                action: value1,
                details: value2,
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
            },
        });
    }

    $('#start-timer').on('click', function () {
        const status = isRunning ? 'pause' : 'start';

        $.ajax({
            url: '/scoring-board/{{ admin_tatami.tatami.pk }}/message-retriever',
            type: 'POST',
            data: {
                action: 'timer-status',
                details: status,
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
            },
        });

        if (status == 'pause') {
            $.ajax({
                url: '/scoring-board/{{ admin_tatami.tatami.pk }}/message-retriever',
                type: 'POST',
                data: {
                    action: 'timer-sync',
                    details: JSON.stringify([totalSeconds, milliseconds]),
                    csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
                },
            });
        }

        if (!isRunning) {
            isRunning = true;
            $(this).text('Pause').removeClass('btn-primary').addClass('btn-danger');

            interval = setInterval(() => {
                if (milliseconds === 0) {
                    if (totalSeconds === 0) {
                        clearInterval(interval);
                        isRunning = false;
                        $('#start-timer').text('Start').removeClass('btn-danger').addClass('btn-primary');
                        return;
                    }
                    totalSeconds--;
                    milliseconds = 99;
                } else {
                    milliseconds--;
                }
                updateDisplay(totalSeconds, milliseconds);
            }, 10);
        } else {
            isRunning = false;
            clearInterval(interval);
            $(this).text('Start').removeClass('btn-danger').addClass('btn-primary');
        }
    });

    const kataList = [
        "Blank",
        "Anan",
        "Anan Dai",
        "Ananko",
        "Aoyagi",
        "Bassai",
        "Bassai Dai",
        "Bassai Sho",
        "Chatanyara Kusanku",
        "Chibana No Kushanku",
        "Chinte",
        "Chinto",
        "Enpi",
        "Fukyugata Ichi",
        "Fukvugata Ni",
        "Gankaku",
        "Garyu",
        "Gekisai (Geksai) 1",
        "Gekisai (Geksai) 2",
        "Gojushiho",
        "Gojushiho Dai",
        "Gojushiho Sho",
        "Hakucho",
        "Hangetsu",
        "Haufa (Haffa)",
        "Heian Shodan",
        "Heian Nidan",
        "Heian Sandan",
        "Heian Yondan",
        "Heian Godan",
        "Heiku",
        "Ishimine Bassai",
        "Itosu Rohai Shodan",
        "Itosu Rohai Nidan",
        "Itosu Rohai Sandan",
        "Jiin",
        "Jion",
        "Jitte",
        "Juroku",
        "Kanchin",
        "Kanku Dai",
        "Kanku Sho",
        "Kanshu",
        "Kishimoto No Kushanku",
        "Kousoukun",
        "Kousoukun Dai",
        "Kousoukun Sho",
        "Kururunfa",
        "Kusanku",
        "Kyan No Chinto",
        "Kyan No Wanshu",
        "Matsukaze",
        "Matsumura Bassai",
        "Matsumura Rohai",
        "Meikyo",
        "Myojo",
        "Naifanchin Shodan",
        "Naifanchin Nidan",
        "Naifanchin Sandan",
        "Naihanchi",
        "Nijushiho",
        "Nipaipo",
        "Niseishi",
        "Ohan",
        "Ohan Dai",
        "Oyadomari No Passai",
        "Pachu",
        "Paiku",
        "Papuren",
        "Passai",
        "Pinan Shodan",
        "Pinan Nidan",
        "Pinan Sandan",
        "Pinan Yondan",
        "Pinan Godan",
        "Rohai",
        "Saifa",
        "Sanchin",
        "Sansai",
        "Sanseiru",
        "Sanseni",
        "Seichin",
        "Seienchin (Seiyunchin)",
        "Seipai",
        "Seiryu",
        "Seishan",
        "Seisan (Sesan)",
        "Shiho Kousoukun",
        "Shinpa",
        "Shinsei",
        "Shisochin",
        "Sochin",
        "Suparinpei",
        "Tekki Shodan",
        "Tekki Nidan",
        "Tekki Sandan",
        "Tensho",
        "Tomari Bassai",
        "Unshu",
        "Unsu",
        "Useishi",
        "Wankan",
        "Wanshu"
    ];

    var kata_aka = '{{ detail_bagan.kata1 }}';
    var kata_ao = '{{ detail_bagan.kata2 }}';
    
    if (tipeTanding == '1') {
        function populateSelect(selectElement, selectedValue) {
            kataList.forEach((kata, index) => {
                const option = document.createElement('option');
                option.value = `${index} - ${kata}`;
                option.textContent = `${index} - ${kata}`;

                // Set selected if this option matches the value from the DB
                if (option.value === selectedValue) {
                    option.selected = true;
                }

                selectElement.appendChild(option);
            });
        }

        populateSelect(kataAka, kata_aka);
        populateSelect(kataAo, kata_ao);
    }
</script>
{% endblock script %}