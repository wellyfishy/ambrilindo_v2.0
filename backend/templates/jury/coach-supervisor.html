{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coach Supervisor Panel</title>
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}"/>
    <link rel="stylesheet" href="{% static 'css/plugins.min.css' %}" />
    <link rel="stylesheet" href="{% static 'css/ambrilindo.min.css' %}" />
    <link rel="stylesheet" href="{% static 'icons/fontawesome-free/css/all.min.css' %}" />
    <style>
        body {
            background-color:rgb(25, 25, 25);
            color: gold;
            font-family: sans-serif;
        }

        .ambrilindo-logo {
            display: block;
            margin: 0 auto;
            max-width: 80%;
            height: auto;
        }

        input.slider-red {
            width: 80%;
            -webkit-appearance: none;
            background: transparent;
        }

        input.slider-red::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 30px;
            width: 30px;
            background: red;
            border-radius: 50%;
            cursor: pointer;
            margin-top: -10px;
        }

        input.slider-red::-webkit-slider-runnable-track {
            height: 8px;
            background: #ccc;
            border-radius: 4px;
        }

        input.slider-red::-moz-range-thumb {
            height: 30px;
            width: 30px;
            background: red;
            border: none;
            border-radius: 50%;
            cursor: pointer;
        }

        input.slider-red::-moz-range-track {
            height: 8px;
            background: #ccc;
            border-radius: 4px;
        }

        /* === Disabled state === */

        input.slider-red:disabled::-webkit-slider-thumb {
            background: #999;
            cursor: not-allowed;
        }

        input.slider-red:disabled::-moz-range-thumb {
            background: #999;
            cursor: not-allowed;
        }

        input.slider-blue {
            width: 80%;
            -webkit-appearance: none;
            background: transparent;
        }

        input.slider-blue::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 30px;
            width: 30px;
            background: blue;
            border-radius: 50%;
            cursor: pointer;
            margin-top: -10px;
        }

        input.slider-blue::-webkit-slider-runnable-track {
            height: 8px;
            background: #ccc;
            border-radius: 4px;
        }

        input.slider-blue::-moz-range-thumb {
            height: 30px;
            width: 30px;
            background: blue;
            border: none;
            border-radius: 50%;
            cursor: pointer;
        }

        input.slider-blue::-moz-range-track {
            height: 8px;
            background: #ccc;
            border-radius: 4px;
        }

        /* === Disabled state === */

        input.slider-blue:disabled::-webkit-slider-thumb {
            background: #999;
            cursor: not-allowed;
        }

        input.slider-blue:disabled::-moz-range-thumb {
            background: #999;
            cursor: not-allowed;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <hr>

    <div style="">
        <div id="aka-banner">
            <div style="text-align: center; background: linear-gradient(to bottom, rgb(255, 112, 112),rgb(255, 46, 46)); top-left-radius: 10px; border-top-right-radius: 10px;">
                <h1 style="padding-top: 10px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 90%; margin: 0 auto; color: white;">
                    <b>VR BUTTON AKA</b> 
                    <button class="btn btn-danger" style="margin-bottom: 10px;" id="aka-expand">
                        <i class="fa fa-expand"></i>
                    </button> 
                    <br>
                </h1>
            </div>
            <div style="background-color: white; padding-bottom: 20px; text-align: center;">
                <br>
                <button class="btn btn-danger" id="aka1" style="font-size: 50px; font-weight: bold">1</button>
                <button class="btn btn-danger" id="aka2" style="font-size: 50px; font-weight: bold; margin-left: 20px">2</button>
                <button class="btn btn-danger" id="aka3" style="font-size: 50px; font-weight: bold; margin-left: 20px">3</button>
            </div>
            <div style="background: linear-gradient(to top, rgb(255, 112, 112),rgb(255, 46, 46)); border-bottom-left-radius: 10px; border-bottom-right-radius: 10px; padding: 5px;">
                <div style="text-align: center;">
                    <h1 style="padding-top: 10px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 90%; margin: 0 auto; color: white;">
                    <b>REQUESTED:</b> 
                    <span id="requested-aka">-</span>
                    <button class="btn btn-success" style="font-weight: bold; display: none" id="revisi-aka">REVISI</button>
                </h1>
                </div>
            </div>
        </div>


        <div id="ao-banner">
            <div style="text-align: center; background: linear-gradient(to bottom, rgb(105, 120, 255),rgb(26, 80, 255)); top-left-radius: 10px; border-top-right-radius: 10px; margin-top: 10px;">
                <h1 style="padding-top: 10px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 90%; margin: 0 auto; color: white;">
                    <b>VR BUTTON AO</b> 
                    <button class="btn btn-primary" style="margin-bottom: 10px;" id="ao-expand">
                        <i class="fa fa-expand"></i>
                    </button> 
                    <br>
                </h1>
            </div>
            <div style="background-color: white; padding-bottom: 20px; text-align: center;">
                <br>
                <button class="btn btn-primary" id="ao1" style="font-size: 50px; font-weight: bold">1</button>
                <button class="btn btn-primary" id="ao2" style="font-size: 50px; font-weight: bold; margin-left: 20px">2</button>
                <button class="btn btn-primary" id="ao3" style="font-size: 50px; font-weight: bold; margin-left: 20px">3</button>
            </div>
            <div style="background: linear-gradient(to bottom, rgb(105, 120, 255),rgb(26, 80, 255)); border-bottom-left-radius: 10px; border-bottom-right-radius: 10px; padding: 5px;">
                <div style="text-align: center;">
                    <h1 style="padding-top: 10px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 90%; margin: 0 auto; color: white;">
                    <b>REQUESTED:</b> 
                    <span id="requested-ao">-</span>
                    <button class="btn btn-success" style="font-weight: bold; display: none" id="revisi-ao">REVISI</button>
                </h1>
                </div>
            </div>
        </div>
    </div>
    <hr>
    <div style="text-align: center;">
        <h2>Coach Supervisor Tatami {{ tatami.tatami_number }}</h2>
        <a href="" class="btn btn-success">
            <i class="fa fa-arrows-rotate"></i>
        </a>
    </div>
    <div class="ambrilindo-logo">
        <img class="ambrilindo-logo" src="{% static 'img/ambrilindo/ambrilindo-logo-dark.png' %}" alt="">
    </div>
    <script src="{% static 'js/jquery.min.js' %}"></script>
    <script src="{% static 'js/core/bootstrap.min.js' %}"></script>
    <script src="{% static 'js/ambrilindo.min.js' %}"></script>

    <script>
        $(document).ready(function () {
            const tatamiPk = {{ tatami.pk }}
            var detail_bagan_pk = '' 
            const protocol = window.location.protocol === 'https:' ? 'wss://' : 'ws://';
            const socket = new WebSocket(protocol + window.location.host + `/ws/coach-supervisor/${tatamiPk}`);
            socket.onmessage = function(e) {
                const data = JSON.parse(e.data);
                console.log(data.command, data.details)

                if (data.command == 'vr_status') {
                    var arr = JSON.parse(data.details);
                    var player = arr[0];
                    var status = arr[1];

                    if (player == 'aka') {
                        if (status == '1') {
                            $('#requested-aka').text('-')
                            $('#aka1, #aka2, #aka3').removeClass('btn-dark').addClass('btn-danger');
                            $('#aka1, #aka2, #aka3').prop('disabled', false);
                            $('#aka1, #aka2, #aka3').blur()
                        } else {
                            $('#requested-aka').text('-')
                            $('#aka1, #aka2, #aka3').removeClass('btn-dark').addClass('btn-danger');
                            $('#aka1, #aka2, #aka3').prop('disabled', true);
                        }
                    }
                    if (player == 'ao') {
                        if (status == '1') {
                            $('#requested-ao').text('-')
                            $('#ao1, #ao2, #ao3').removeClass('btn-dark').addClass('btn-primary');
                            $('#ao1, #ao2, #ao3').prop('disabled', false);
                            $('#ao1, #ao2, #ao3').blur()
                        } else {
                            $('#requested-ao').text('-')
                            $('#ao1, #ao2, #ao3').removeClass('btn-dark').addClass('btn-primary');
                            $('#ao1, #ao2, #ao3').prop('disabled', true);
                        }
                    }
                } else if (data.command == 'get_atlet') {
                    if (data.details[0] == true) {
                        $('#requested-aka').text('-')
                        $('#aka1, #aka2, #aka3').removeClass('btn-dark').addClass('btn-danger');
                        $('#aka1, #aka2, #aka3').prop('disabled', false);
                    } else {
                        $('#requested-aka').text('-')
                        $('#aka1, #aka2, #aka3').removeClass('btn-dark').addClass('btn-danger');
                        $('#aka1, #aka2, #aka3').prop('disabled', true);
                    }
                    if (data.details[1] == true) {
                        $('#requested-ao').text('-')
                        $('#ao1, #ao2, #ao3').removeClass('btn-dark').addClass('btn-primary');
                        $('#ao1, #ao2, #ao3').prop('disabled', false);
                    } else {
                        $('#requested-ao').text('-')
                        $('#ao1, #ao2, #ao3').removeClass('btn-dark').addClass('btn-primary');
                        $('#ao1, #ao2, #ao3').prop('disabled', true);
                    }
                }
            }

            $('#revisi-aka').on('click', function() {
                $('#requested-aka').text('-')
                $('#aka1, #aka2, #aka3').removeClass('btn-dark').addClass('btn-danger');
                $('#aka1, #aka2, #aka3').prop('disabled', false);
                coach_send('aka', '1')
            })

            $('#revisi-ao').on('click', function() {
                $('#requested-ao').text('-')
                $('#ao1, #ao2, #ao3').removeClass('btn-dark').addClass('btn-primary');
                $('#ao1, #ao2, #ao3').prop('disabled', false);
                coach_send('ao', '1')
            })

            let focus_aka = false;
            let focus_ao = false;

            let isExpanding = false

            $('#aka-expand').on('click', function () {
                isExpanding = !isExpanding;

                $('#ao-banner').toggle(!isExpanding);
                $('#aka-banner').show();
            });
            $('#ao-expand').on('click', function () {
                isExpanding = !isExpanding;

                $('#aka-banner').toggle(!isExpanding);
                $('#ao-banner').show();
            });

            $('#aka1').on('click', function () {
                $('#aka1').removeClass('btn-danger').addClass('btn-dark')
                coach_send('aka', '1');
                aka_disabled(1)
            });
            $('#aka2').on('click', function () {
                $('#aka2').removeClass('btn-danger').addClass('btn-dark')
                coach_send('aka', '2');
                aka_disabled(2)
            });
            $('#aka3').on('click', function () {
                $('#aka3').removeClass('btn-danger').addClass('btn-dark')
                coach_send('aka', '3');
                aka_disabled(3)
            });
            $('#ao1').on('click', function () {
                $('#ao1').removeClass('btn-primary').addClass('btn-dark')
                coach_send('ao', '1');
                ao_disabled(1)
            });
            $('#ao2').on('click', function () {
                $('#ao2').removeClass('btn-primary').addClass('btn-dark')
                coach_send('ao', '2');
                ao_disabled(2)
            });
            $('#ao3').on('click', function () {
                $('#ao3').removeClass('btn-primary').addClass('btn-dark')
                coach_send('ao', '3');
                ao_disabled(3)
            });

            function aka_disabled(val) {
                $('#aka1, #aka2, #aka3').prop('disabled', true);
                $('#requested-aka').text(val)
            }
            function ao_disabled(val) {
                $('#ao1, #ao2, #ao3').prop('disabled', true);
                $('#requested-ao').text(val)
            }

            function coach_send(team, val) {
                
                $.ajax({
                    url: '/scoring-board/{{ tatami.pk }}/message-retriever',
                    type: 'POST',
                    data: {
                        action: 'coach-supervisor',
                        details: JSON.stringify([team, val]),
                        csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
                    },
                });

                $.ajax({
                    url: '/control-panel/{{ tatami.pk }}/message-retriever',
                    type: 'POST',
                    data: {
                        action: 'coach-supervisor',
                        details: JSON.stringify([team, val]),
                        csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
                    },
                });
            }
        });
    </script>
</body>
</html>